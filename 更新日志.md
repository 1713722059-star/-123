# 温婉0.2 更新日志

## 版本 0.2.2 - 精确位置系统

### ✨ 新功能

1. **精确位置系统（Precise Location System）**
   - **核心概念**：区分"大地点"和"精确位置"，实现更真实的寻找机制
   - **室内地点（家）**：范围小，100%能找到温婉
   - **大地点（学校、展会中心、港口等）**：范围大，即使在同一大地点也不一定能找到
   - **精确位置字段（exactLocation）**：温婉在大地点时的具体位置（如"cos社活动室"、"A展厅"、"游艇上"）
   - **可访问性字段（isAccessible）**：是否可被找到（如游艇已出海则false）

2. **概率性找到机制**
   - 学校：30%概率找到
   - 展会中心：20%概率找到
   - 港口：10%概率找到（可能已出海）
   - 商城：40%概率找到
   - 电影院：50%概率找到
   - 游乐场：35%概率找到

3. **通过微聊获取精确位置**
   - 玩家可以通过微聊询问"你在哪"
   - 温婉会回复精确位置（如"我在展会中心的A展厅"）
   - 知道精确位置后，前往该大地点可以100%找到温婉

### 🎮 玩法改进

1. **更真实的NTR场景**
   - 温婉在展会中心被NTR，玩家前往展会中心但找不到她
   - 等找到的时候，NTR事件可能已经结束
   - 增加了游戏的紧张感和真实感

2. **游艇出海场景**
   - 温婉坐游艇出海，玩家去港口也找不到（游艇已出海）
   - 只能通过微聊联系，无法直接找到

3. **学校场景**
   - 温婉在学校cos社活动室，玩家去学校不一定能找到
   - 需要知道具体位置或通过概率找到

### 🐛 Bug修复

1. **删除占位推特代码**
   - 问题：NTR事件发生时，如果AI未生成推特，会显示占位提示
   - 修复：删除占位推特逻辑，如果AI未生成推特则不显示任何内容
   - 现在完全依赖AI生成推特内容，不再显示系统占位提示

### 🔧 系统优化

1. **位置判断逻辑优化**
   - 更新远程互动判断，加入精确位置判断
   - 同一大地点但无精确位置信息 → 可能是远程（概率性找到）
   - 同一大地点且有精确位置信息 → 不是远程（可以找到）

2. **系统提示词更新**
   - 添加精确位置系统的详细说明
   - 告诉AI如何设置exactLocation和isAccessible字段
   - 告诉AI如何描述玩家在大地点中寻找温婉的过程

3. **数据结构扩展**
   - BodyStatus接口添加exactLocation和isAccessible字段
   - 响应格式规则更新，包含精确位置字段示例

---

## 版本 0.2.1 - 系统重构与优化

### 🐛 Bug修复

1. **修复跳过时间的好感度减少问题**
   - 问题：点击"跳过1天"时也会减少3点好感度
   - 修复：现在只有点击"跳过3天"才会减少好感度，"跳过1天"不再减少

2. **修复黄毛邀请判断逻辑**
   - 问题：高好感度（95）时，温婉仍然接受黄毛的邀请
   - 修复：加入好感度影响机制，好感度越高，温婉越倾向于拒绝黄毛邀请
     - 好感90+：拒绝（除非堕落>好感）
     - 好感70-89：80%概率拒绝
     - 好感50-69：50%概率拒绝
     - 好感30-49：20%概率拒绝
     - 好感0-29：接受

### ✨ 新功能

1. **自动时间流逝系统**
   - AI现在可以识别"睡觉"、"晚安"等指令
   - 自动描述时间流逝到第二天早上7点
   - 无需手动点击时间跳过按钮

### 🔧 系统优化

1. **简化行为系统**
   - 移除复杂的弧光系统（A/B/C/D/E）
   - 改用简洁的好感度+堕落度系统
   - 行为模式更直观、易理解

2. **代码清理**
   - 删除5个废弃的规则文件
   - 删除6个废弃的函数
   - 删除2个废弃的数据字段
   - 修复3处过时的弧光引用
   - 减少约600-800行废弃代码

3. **规则整合**
   - 整合重复的时间规则定义
   - 整合重复的好感度规则定义
   - 统一规则来源，避免重复

4. **世界书优化**
   - 删除所有弧光相关内容
   - 保留世界背景设定
   - 根据前端可访问的地点优化地点描述

### 📝 其他改进

- 丰富温婉的人设描述（外貌、性格、背景等）
- 优化系统提示词结构
- 提升代码可维护性

---

**版本 0.2.2 更新日期**：2024年  
**主要改动**：精确位置系统、删除占位推特、玩法改进

---

**版本 0.2.1 更新日期**：2024年  
**主要改动**：系统重构、Bug修复、代码清理
